Fix up the code a bit; use idiomatic Ruby
